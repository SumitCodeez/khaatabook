<%- include('./partials/header.ejs') %> <% if(success.length > 0) { %>
<div
  class="absolute top-5 left-1/2 -translate-x-1/2 -translate-y-1/2 p-3 rounded-md bg-blue-500"
>
  <span class="inline-block mt-1 mb-1 text-white"><%= success %></span>
</div>
<% } %>
<div class="container mx-auto px-20 py-10 relative">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-3xl">Hey, <%= user.username %> üëãüèª</h1>
    <div class="absolute top-[-4.7vw] left-[95.8vw] group">
      <% if(!user.profilePicture || !user.profilePicture.data) { %>
      <img
        src="/images/profile picture.jpg"
        alt="Profile Picture"
        class="w-10 h-10 rounded-full cursor-pointer"
        id="profileTag"
      />
      <% } else { %>
      <img
        src="data:<%= user.profilePicture.contentType %>;base64,<%= user.profilePicture.data.toString('base64') %>"
        alt="Profile Picture"
        class="w-10 h-10 rounded-full cursor-pointer"
        id="profileTag"
      />
      <% } %>
      <div
        class="profile-heading mt-2 bg-black bg-opacity-65 text-white py-1 px-2 rounded hidden group-hover:block"
      >
        Profile
      </div>
    </div>
  </div>
  <h3 class="opacity-50 mb-10">Showing all hisaabs till now.</h3>
  <div>
    <form class="flex mb-10 gap-5" action="/profile" method="get">
      <div
        class="px-4 py-2 flex items-center gap-4 font-medium text-sm text-zinc-500 bg-zinc-200 rounded-md"
      >
        Filters <i class="ri-sound-module-fill"></i>
      </div>
      <div
        id="bydate"
        class="px-4 py-2 flex items-center gap-4 font-medium text-sm text-zinc-500 bg-zinc-200 rounded-md cursor-pointer"
      >
        By Date <i class="ri-calendar-line"></i>
      </div>
      <div class="hidden dates flex gap-5 items-center">
        <input
          class="bg-zinc-200 text-sm px-4 py-2 rounded-md"
          name="startDate"
          type="date"
        />
        <input
          class="bg-zinc-200 text-sm px-4 py-2 rounded-md"
          name="endDate"
          type="date"
        />
      </div>
      <select class="outline-none" name="byDate" id="">
        <option value="-1">Newest First</option>
        <option value="1">Oldest First</option>
      </select>
      <input
        class="px-6 py-2 bg-blue-500 text-white rounded-md"
        type="submit"
        value="Filter"
      />
    </form>
  </div>
  <div class="grid grid-cols-3 gap-4">
    <% user.hisaab.forEach(function(hisaab) { %>
    <div
      class="p-4 bg-stone-200 border-2 rounded-lg hover:bg-gray-200 relative transition-all duration-300 transform hover:scale-105"
    >
      <% if(hisaab.encrypted === true) { %>
      <div
        class="absolute top-0 left-0 mt-2 ml-2 bg-blue-500 text-white px-2 py-1 text-sm rounded"
      >
        <i class="ri-lock-line"></i> Encrypted
      </div>
      <% } else { %>
      <div
        class="absolute top-0 left-0 mt-2 ml-2 bg-green-500 text-white px-2 py-1 text-sm rounded"
      >
        <i class="ri-check-line"></i> Available
      </div>
      <% } %> <% if(!hisaab.shareable) { %>
      <div
        class="absolute top-0 left-28 mt-2 ml-0.5 px-2 py-0.5 bg-zinc-400 rounded"
      >
        <i class="ri-eye-off-line"></i>
      </div>
      <% } else { %>
      <div
        class="absolute top-0 left-24 ml-3 mt-2 px-2 py-0.5 bg-zinc-400 rounded"
      >
        <i class="ri-eye-line"></i>
      </div>
      <% } %>
      <div class="font-bold mb-2 mt-8"><%= hisaab.title %></div>
      <div class="text-gray-500">
        Created on <%= new Date(hisaab.createdAt).toLocaleDateString() %>
      </div>
      <a
        href="/hisaab/view/<%= hisaab.id %>"
        class="text-blue-500 hover:underline"
        >View Hisaab</a
      >
    </div>
    <% }) %>
  </div>
</div>

<div
  id="overlayMenu"
  class="hidden fixed top-0 right-0 h-full w-64 bg-white shadow-lg z-50 p-6 transform translate-x-full transition-transform duration-300 ease-in-out"
>
  <button
    class="absolute top-4 right-4 text-gray-700 text-3xl hover:text-gray-900 transition-colors duration-200"
    id="closeOverlay"
  >
    &times;
  </button>
  <div class="flex flex-col items-center mt-12">
    <img
      src="<%= user.profilePicture && user.profilePicture.data ? 'data:' + user.profilePicture.contentType + ';base64,' + user.profilePicture.data.toString('base64') : '/images/profile picture.jpg' %>"
      alt="Profile Picture"
      class="w-24 h-24 rounded-full mb-4 shadow-md border-2 border-gray-200"
    />
    <h2 class="text-2xl font-semibold mb-2 text-gray-800"><%= user.username %></h2>
    <p class="text-gray-600 mb-4"><%= user.email %></p>
    <form
      action="/upload-profile-picture"
      method="post"
      enctype="multipart/form-data"
      class="mt-4 w-full"
    >
      <label
        for="profilePicture"
        class="block text-sm font-medium text-gray-700 mb-2"
      >
        Upload Profile Picture
      </label>
      <input
        type="file"
        name="profilePicture"
        id="profilePicture"
        class="block w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 cursor-pointer focus:outline-none p-2 mb-4"
        required
      />
      <button
        type="submit"
        class="w-full py-2 bg-green-600 text-white rounded-md shadow hover:bg-green-700 transition-all duration-200"
      >
        Upload
      </button>
    </form>
  </div>
</div>

<script>
  document.querySelector("#bydate").addEventListener("click", function () {
    document.querySelector(".dates").classList.toggle("hidden");
  });

  document.querySelector("#profileTag").addEventListener("click", function () {
    document.querySelector("#overlayMenu").classList.remove("hidden");
    setTimeout(function () {
      document
        .querySelector("#overlayMenu")
        .classList.remove("translate-x-full");
    }, 10);
  });

  document
    .querySelector("#closeOverlay")
    .addEventListener("click", function () {
      document.querySelector("#overlayMenu").classList.add("translate-x-full");
      setTimeout(function () {
        document.querySelector("#overlayMenu").classList.add("hidden");
      }, 300);
    });
</script>
<%- include('./partials/footer.ejs') %>
